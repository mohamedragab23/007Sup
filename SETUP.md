# دليل الإعداد الكامل

## الخطوة 1: إعداد Google Cloud Project

1. اذهب إلى [Google Cloud Console](https://console.cloud.google.com/)
2. أنشئ مشروع جديد أو اختر مشروع موجود
3. فعّل Google Sheets API:
   - اذهب إلى "APIs & Services" > "Library"
   - ابحث عن "Google Sheets API"
   - اضغط "Enable"

## الخطوة 2: إنشاء Service Account

1. اذهب إلى "IAM & Admin" > "Service Accounts"
2. اضغط "Create Service Account"
3. أدخل اسم Service Account (مثلاً: `sheets-api-service`)
4. اضغط "Create and Continue"
5. اضغط "Done" (يمكنك تخطي الخطوات الأخرى)
6. اضغط على Service Account الذي أنشأته
7. اذهب إلى تبويب "Keys"
8. اضغط "Add Key" > "Create new key"
9. اختر "JSON" وحمّل الملف

## الخطوة 3: إعداد ملف Google Sheets

1. افتح ملف Google Sheets الخاص بك
2. اضغط على زر "مشاركة" (Share)
3. أضف بريد Service Account (موجود في ملف JSON الذي حمّلته)
4. أعطه صلاحية "محرر" (Editor)
5. اضغط "إرسال" (Send)

## الخطوة 4: إعداد متغيرات البيئة

1. انسخ ملف `.env.example` إلى `.env.local`
2. افتح ملف JSON الذي حمّلته من Google Cloud
3. انسخ القيم التالية:

```env
GOOGLE_SHEETS_SPREADSHEET_ID=1Oxdp2vH0DHkEZwxxUdQhzMgfco9yVKlkJ9llkB4oSqE
GOOGLE_SERVICE_ACCOUNT_EMAIL=your-service-account@project.iam.gserviceaccount.com
GOOGLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY\n-----END PRIVATE KEY-----\n"
GOOGLE_PROJECT_ID=your-project-id
JWT_SECRET=your-random-secret-key-here
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

**ملاحظات مهمة:**
- `GOOGLE_PRIVATE_KEY` يجب أن يكون بين علامات اقتباس ويحتوي على `\n` كما هو موضح
- `JWT_SECRET` يجب أن يكون مفتاح عشوائي قوي (يمكنك استخدام: `openssl rand -base64 32`)

## الخطوة 5: تثبيت الحزم

```bash
npm install
# أو
yarn install
```

## الخطوة 6: تشغيل المشروع

```bash
npm run dev
# أو
yarn dev
```

افتح [http://localhost:3000](http://localhost:3000)

## الخطوة 7: النشر على Vercel

1. اربط مستودع GitHub مع Vercel
2. في إعدادات المشروع، اذهب إلى "Environment Variables"
3. أضف جميع المتغيرات من `.env.local`:
   - `GOOGLE_SHEETS_SPREADSHEET_ID`
   - `GOOGLE_SERVICE_ACCOUNT_EMAIL`
   - `GOOGLE_PRIVATE_KEY` (انسخه كما هو مع `\n`)
   - `GOOGLE_PROJECT_ID`
   - `JWT_SECRET`
   - `NEXT_PUBLIC_APP_URL` (URL الخاص بـ Vercel)

4. انشر المشروع

## هيكل الأوراق في Google Sheets

تأكد من وجود الأوراق التالية في ملف Google Sheets:

### ورقة "المشرفين"
| الكود | الاسم | المنطقة | البريد الإلكتروني | كلمة المرور |
|------|------|---------|------------------|------------|
| SUP001 | أحمد محمد | القاهرة | ahmed@example.com | password123 |

### ورقة "المناديب"
| كود المندوب | الاسم | المنطقة | كود المشرف | اسم المشرف | الهاتف | تاريخ الانضمام | الحالة |
|------------|------|---------|-----------|-----------|--------|---------------|--------|
| RID001 | محمد علي | القاهرة | SUP001 | أحمد محمد | 0123456789 | 2024-01-01 | نشط |

### ورقة "البيانات اليومية"
| التاريخ | كود المندوب | ساعات العمل | البريك | التأخير | الغياب | عدد الطلبات | نسبة القبول | المديونية |
|---------|------------|------------|--------|---------|--------|------------|------------|-----------|
| 2024-01-15 | RID001 | 8 | 1 | 0 | لا | 25 | 95% | 0 |

### ورقة "الخصومات"
| كود المشرف | الشهر | سبب الخصم | المبلغ |
|-----------|-------|----------|--------|
| SUP001 | 1 | تأخير | 100 |

### ورقة "السلف"
| كود المشرف | الشهر | المبلغ |
|-----------|-------|--------|
| SUP001 | 1 | 500 |

### ورقة "استعلام أمني"
| التاريخ | اسم المندوب | كود المندوب | نوع الاستعلام | النتيجة | كود المشرف |
|---------|------------|------------|--------------|---------|-----------|
| 2024-01-10 | محمد علي | RID001 | استعلام | موافق | SUP001 |

### ورقة "المعدات"
| كود المشرف | الشهر | اسم المعدة | الكمية | سعر الوحدة | سبب الصرف | التكلفة الإجمالية |
|-----------|-------|-----------|--------|-----------|-----------|------------------|
| SUP001 | 1 | خوذة | 5 | 50 | صرف جديد | 250 |

### ورقة "الأهداف"
| كود المشرف | الشهر | الهدف | الإنجاز الفعلي | البونص |
|-----------|-------|------|---------------|--------|
| SUP001 | 1 | 1000 | 1200 | 500 |

## استكشاف الأخطاء

### خطأ: "لا يمكن الوصول إلى ملف البيانات"
- تأكد من مشاركة ملف Google Sheets مع Service Account
- تحقق من صحة `GOOGLE_SHEETS_SPREADSHEET_ID`

### خطأ: "Authentication failed"
- تحقق من صحة `GOOGLE_PRIVATE_KEY` (يجب أن يحتوي على `\n`)
- تأكد من أن Service Account له صلاحيات كافية

### خطأ: "ورقة غير موجودة"
- تأكد من وجود جميع الأوراق المطلوبة
- تحقق من أن أسماء الأوراق مطابقة تماماً (حساسة لحالة الأحرف)

## الدعم

إذا واجهت أي مشاكل، تحقق من:
1. سجلات Vercel (Logs)
2. Console في المتصفح
3. ملف `.env.local` (تأكد من عدم وجود أخطاء)

